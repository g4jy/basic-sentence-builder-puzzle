<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Korean Playground</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Gaegu:wght@400;700&family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/kids.css">
</head>
<body>
  <div class="page-wrapper">

    <!-- Hero -->
    <div class="hub-hero">
      <span class="deco deco-1">&#11088;</span>
      <span class="deco deco-2">&#10024;</span>
      <span class="deco deco-3">&#127752;</span>
      <span class="deco deco-4">&#127775;</span>
      <h1>Korean Playground</h1>
      <p id="hero-subtitle">Choose your name to start!</p>
    </div>

    <!-- Welcome Banner (shown in direct link mode) -->
    <div id="welcome-banner" class="welcome-banner hidden">
      <span class="welcome-emoji" id="welcome-emoji"></span>
      <div class="welcome-text">
        <h2 id="welcome-name"></h2>
        <p>Let's learn Korean today!</p>
      </div>
    </div>

    <!-- Student Selection -->
    <div class="student-select" id="student-select">
      <div class="student-card" data-student="asa" onclick="selectStudent('asa')">
        <span class="student-emoji">&#129490;</span>
        <div class="student-name">Asa</div>
        <div class="student-name-kr">&#50640;&#51060;&#49324;</div>
      </div>
      <div class="student-card" data-student="leah" onclick="selectStudent('leah')">
        <span class="student-emoji">&#128103;</span>
        <div class="student-name">Leah</div>
        <div class="student-name-kr">&#47532;&#50500;</div>
      </div>
      <div class="student-card" data-student="inessa" onclick="selectStudent('inessa')">
        <span class="student-emoji">&#127908;</span>
        <div class="student-name">Inessa</div>
        <div class="student-name-kr">&#51060;&#45348;&#49324;</div>
      </div>
    </div>

    <!-- Game Menu (shown after student selection) -->
    <div id="game-menu" class="hidden">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:4px;">
        <h2 style="font-family:'Fredoka',sans-serif;font-size:1.4rem;font-weight:700;color:var(--text);">Pick a Game!</h2>
        <button class="btn btn-ghost" id="switch-btn" onclick="changeStudent()" style="font-size:0.9rem;">Switch</button>
      </div>

      <div class="game-grid">
        <a href="picture-quiz.html" class="game-card">
          <div class="game-icon" style="background:linear-gradient(135deg,#D1FAE5,#A7F3D0);">&#128444;&#65039;</div>
          <div class="game-info">
            <h3>Picture Quiz</h3>
            <p>Match sentences with pictures!</p>
          </div>
        </a>

        <a href="sentence-puzzle.html" class="game-card">
          <div class="game-icon" style="background:linear-gradient(135deg,#FFF3E0,#FED7AA);">&#129513;</div>
          <div class="game-info">
            <h3>Sentence Puzzle</h3>
            <p>Build Korean sentences!</p>
          </div>
        </a>

        <a href="memory-match.html" class="game-card">
          <div class="game-icon" style="background:linear-gradient(135deg,#EDE9FE,#C4B5FD);">&#127183;</div>
          <div class="game-info">
            <h3>Memory Match</h3>
            <p>Find the matching pairs!</p>
          </div>
        </a>

        <a href="word-explorer.html" class="game-card">
          <div class="game-icon" style="background:linear-gradient(135deg,#FCE7F3,#FBCFE8);">&#128218;</div>
          <div class="game-info">
            <h3>Word Explorer</h3>
            <p>Learn new words & pictures!</p>
          </div>
        </a>
      </div>

      <!-- Settings -->
      <div class="settings-card">
        <div class="toggle-row">
          <span class="toggle-label">Show Romanization (abc)</span>
          <label class="toggle-switch">
            <input type="checkbox" id="rom-toggle" onchange="toggleRom(this.checked)">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
    </div>

  </div>

  <script src="js/kids-common.js"></script>
  <script>
    const isDirect = KidsApp.isDirectLink();
    const currentStudent = KidsApp.getStudent();
    const studentMeta = {
      asa:    { emoji: '\u{1F9D2}', name: 'Asa',    nameKr: '\uC5D0\uC774\uC0AC' },
      leah:   { emoji: '\u{1F467}', name: 'Leah',   nameKr: '\uB9AC\uC544' },
      inessa: { emoji: '\u{1F3A4}', name: 'Inessa', nameKr: '\uC774\uB124\uC0AC' }
    };

    // Direct link mode: show welcome banner, hide student selection
    if (isDirect && currentStudent) {
      const meta = studentMeta[currentStudent];
      document.getElementById('student-select').style.display = 'none';
      document.getElementById('hero-subtitle').style.display = 'none';
      const banner = document.getElementById('welcome-banner');
      banner.classList.remove('hidden');
      document.getElementById('welcome-emoji').textContent = meta.emoji;
      document.getElementById('welcome-name').textContent = meta.name + "'s Korean Playground";
      showGameMenu(currentStudent, true);
    } else if (currentStudent) {
      showGameMenu(currentStudent, false);
    }

    function selectStudent(id) {
      KidsApp.setStudent(id);
      showGameMenu(id, false);
      document.querySelectorAll('.student-card').forEach(c => c.classList.remove('active'));
      document.querySelector('[data-student="' + id + '"]').classList.add('active');
    }

    function showGameMenu(id, hideSwitch) {
      document.getElementById('game-menu').classList.remove('hidden');
      document.querySelectorAll('.student-card').forEach(c => c.classList.remove('active'));
      const card = document.querySelector('[data-student="' + id + '"]');
      if (card) card.classList.add('active');

      // Hide switch button in direct link mode
      const switchBtn = document.getElementById('switch-btn');
      if (switchBtn && hideSwitch) switchBtn.style.display = 'none';

      // Propagate student param to game links
      if (isDirect) {
        document.querySelectorAll('.game-card').forEach(a => {
          const href = a.getAttribute('href');
          if (href && !href.includes('?')) {
            a.setAttribute('href', href + '?student=' + id);
          }
        });
      }

      const s = KidsApp.getSettings();
      document.getElementById('rom-toggle').checked = s.showRomanization;
    }

    function changeStudent() {
      document.getElementById('game-menu').classList.add('hidden');
      document.querySelectorAll('.student-card').forEach(c => c.classList.remove('active'));
    }

    function toggleRom(checked) {
      const s = KidsApp.getSettings();
      s.showRomanization = checked;
      KidsApp.saveSettings(s);
    }
  </script>
</body>
</html>
